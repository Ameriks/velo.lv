// Generated by CoffeeScript 1.12.7
(function() {
  var check_price, update_line_participant;

  this.Participant_inline_class_added = function(row) {
    return update_line_participant(row);
  };

  check_price = function(row) {
    var birthday, csrf, distance, insurance, url;
    distance = $("select[name$='distance']", row).val();
    birthday = $("select[name$='birthday_year']", row).val();
    insurance = $("[name$='insurance']", row).val();
    csrf = document.getElementsByName('csrfmiddlewaretoken')[0].value;
    url = $(row).parents("form").data('check-price');
    return $.ajax({
      url: url,
      type: 'POST',
      data: {
        csrfmiddlewaretoken: csrf,
        distance: distance,
        birthday_year: birthday,
        insurance: insurance
      },
      dataType: 'json',
      success: function(data) {
        return $('.price', row).html(data.message);
      },
      error: function() {
        return $('.price', row).html('Please enter all details');
      }
    });
  };

  update_line_participant = function(row) {
    var city, country, insurance, ssn;
    ssn = $("input[name$='-ssn']", row);
    insurance = $("select[name$='-insurance']", row);
    city = $("select[name$='-city']", row);
    country = $("select[name$='-country']", row);
    $("input[name$='-first_name']", row).autocomplete({
      serviceUrl: row.parents("form").data("autocomplete"),
      onSelect: function(suggestion) {
        var birthday;
        $("select[name$='country']", row).val(suggestion.country).change();
        $("select[name$='gender']", row).val(suggestion.gender).change();
        $("input[name$='last_name']", row).val(suggestion.last_name).change().focus();
        $("input[name$='bike_brand2']", row).val(suggestion.bike_brand2).change().focus();
        birthday = suggestion.birthday.split('-');
        console.log(birthday);
        $("select[name$='birthday_year']", row).val(parseInt(birthday[0])).change();
        $("select[name$='birthday_month']", row).val(parseInt(birthday[1])).change();
        $("select[name$='birthday_day']", row).val(parseInt(birthday[2])).change();
        $("input[name$='team_name']", row).val(suggestion.team_name).change().focus();
        $("input[name$='phone_number']", row).val(suggestion.phone_number).change().focus();
        return $("input[name$='email']", row).val(suggestion.email).change().focus().blur();
      },
      formatResult: function(suggestion, currentValue) {
        return suggestion.first_name + " " + suggestion.last_name + " " + suggestion.birthday + " ";
      }
    });
    if (row.parents(".formset_container").data("can-delete") === 'False') {
      $('.delete_button', row).remove();
      $('.price', row).remove();
    }
    $(".participant__number", row).html(row.index());
    if (!insurance.val()) {
      $(ssn).parents(".input-wrap").hide();
    }
    insurance.on("change", function(e) {
      var el;
      el = $(ssn).parents(".input-wrap");
      if ($(this).val()) {
        return el.show();
      } else {
        $(ssn).val("");
        return el.hide();
      }
    });
    if (!country.val() === 'LV') {
      $(city).parents(".input-wrap").hide();
    }
    country.on("change", function(e) {
      var el;
      el = $(city).parents(".input-wrap");
      if ($(this).val() === 'LV') {
        return el.show();
      } else {
        $(ssn).val("");
        return el.hide();
      }
    });
    if (!row.hasClass("noadd")) {
      $("select[name$='-birthday_year'], select[name$='distance'], select[name$='insurance']", row).on("change", function(e) {
        check_price(row);
        return void 0;
      });
      check_price(row);
    }
    return void 0;
  };

  $(function() {
    var container, i, len, ref, results;
    if ($(".Participant_inline_class")[0]) {
      ref = $('.item:not(.template)');
      results = [];
      for (i = 0, len = ref.length; i < len; i++) {
        container = ref[i];
        results.push(update_line_participant($(container)));
      }
      return results;
    }
  });

}).call(this);

//# sourceMappingURL=01_registration.js.map
