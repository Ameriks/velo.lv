// Generated by CoffeeScript 1.7.1
(function() {
  var participants;

  participants = null;

  $(function() {
    var tmpl;
    participants = new Bloodhound({
      datumTokenizer: Bloodhound.tokenizers.obj.whitespace('birthday'),
      queryTokenizer: Bloodhound.tokenizers.whitespace,
      remote: participant_search
    });
    participants.initialize();
    tmpl = Handlebars.compile('<p><strong>{{full_name}}</strong><br />{{birthday}}<br />{{ssn}}<br />{{competition__name}}</p>');
    $('#id_birthday').typeahead(null, {
      name: 'birthday',
      displayKey: 'birthday',
      source: participants.ttAdapter(),
      templates: {
        suggestion: tmpl
      }
    });
    $('#id_last_name').typeahead(null, {
      name: 'last_name',
      displayKey: 'last_name',
      source: participants.ttAdapter(),
      templates: {
        suggestion: tmpl
      }
    });
    $('#id_ssn').typeahead(null, {
      name: 'ssn',
      displayKey: 'ssn',
      source: participants.ttAdapter(),
      templates: {
        suggestion: tmpl
      }
    });
    $("#id_birthday, #id_last_name, #id_ssn").bind('typeahead:selected', function(obj, datum) {
      var key, typeaheadInput, value, _results;
      _results = [];
      for (key in datum) {
        value = datum[key];
        if (key === 'birthday' || key === 'ssn' || key === 'last_name') {
          typeaheadInput = $("#id_" + key).data('ttTypeahead').input;
          typeaheadInput.setQuery(value);
          typeaheadInput.resetInputValue();
        } else {
          $("#id_" + key).val(value);
        }
        _results.push("");
      }
      return _results;
    });
    $('#id_ssn').bind('change', function(obj) {
      var input, new_val, value, year;
      value = obj.target.value.replace('-', '');
      year = value[6] === "1" ? "19" : "20";
      input = $("input[name$='birthday']", $(this).parents('form'));
      new_val = "" + year + (value.substr(4, 2)) + "-" + (value.substr(2, 2)) + "-" + (value.substr(0, 2));
      if (input.hasClass('tt-input')) {
        input = input.data('ttTypeahead').input;
        input.setQuery(new_val);
        return input.resetInputValue();
      } else {
        return input.val(new_val);
      }
    });
    return $('.datetimeinput').datetimepicker({
      useSeconds: false,
      minuteStepping: 5,
      pick12HourFormat: false,
      format: 'YYYY-MM-DD HH:mm'
    });
  });

}).call(this);

//# sourceMappingURL=participant_add.map
